<Cube xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ddl2="http://schemas.microsoft.com/analysisservices/2003/engine/2" xmlns:ddl2_2="http://schemas.microsoft.com/analysisservices/2003/engine/2/2" xmlns:ddl100_100="http://schemas.microsoft.com/analysisservices/2008/engine/100/100" xmlns:ddl200="http://schemas.microsoft.com/analysisservices/2010/engine/200" xmlns:ddl200_200="http://schemas.microsoft.com/analysisservices/2010/engine/200/200" xmlns:ddl300="http://schemas.microsoft.com/analysisservices/2011/engine/300" xmlns:ddl300_300="http://schemas.microsoft.com/analysisservices/2011/engine/300/300" xmlns:ddl400="http://schemas.microsoft.com/analysisservices/2012/engine/400" xmlns:ddl400_400="http://schemas.microsoft.com/analysisservices/2012/engine/400/400" xmlns:ddl500="http://schemas.microsoft.com/analysisservices/2013/engine/500" xmlns:ddl500_500="http://schemas.microsoft.com/analysisservices/2013/engine/500/500" xmlns:dwd="http://schemas.microsoft.com/DataWarehouse/Designer/1.0" dwd:design-time-name="cd3e7b3a-5434-4e4e-8209-debc1dff1f01" xmlns="http://schemas.microsoft.com/analysisservices/2003/engine">
  <ID>Finance Cube</ID>
  <MeasureGroups>
    <MeasureGroup>
      <ID>Fact Bill</ID>
      <Partitions>
        <Partition dwd:design-time-name="b5776cf6-744c-4638-8656-9822846bf27e">
          <ID>Fact Bill</ID>
          <Name>Fact Bill Current Year</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="c2cc50b8-a989-4b3f-bc04-8b4aa0731db0">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   current_fin_year = 'Current' AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
          <EstimatedRows>1836255</EstimatedRows>
        </Partition>
        <Partition dwd:design-time-name="7f5a6eac-9062-4e2b-81ed-980fe8f9ecef">
          <ID>Fact Bill 1</ID>
          <Name>Fact Bill 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="13b2338f-422b-416d-b09f-66bab0667d34">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						 
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current')  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current') AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="6107440e-93f1-4083-9391-1fcaf2b9cb4d">
          <ID>Fact Bill 3 and 4 years old</ID>
          <Name>Fact Bill 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="ce837667-8647-47e5-b3af-ce524cc19d4a">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="7692eac5-5665-408f-82e0-14d9a65ae106">
          <ID>Fact Bill 5 and 6 years old</ID>
          <Name>Fact Bill 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="d1075f43-6134-4a87-b122-1cc37c68f78f">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="2c874b8e-e6fa-4be1-be88-f45448ceb9c8">
          <ID>Fact Bill 7 and 8 years old</ID>
          <Name>Fact Bill 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="d47249b1-5f04-4b4a-8728-a1452ed739d5">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="5d0ec959-18e1-486a-984b-5a27efef5e6b">
          <ID>Fact Bill greater than 8 years old</ID>
          <Name>Fact Bill greater than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="24e1b39c-3b77-4c9f-a4e9-4fb4182b6e96">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  
AND  (fact_bill.dim_bill_date_key &gt;= 20100501) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Bill Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="e7980b46-fc8a-41e4-b951-3ec65ee4ddb2">
          <ID>Fact Bill Activity</ID>
          <Name>Fact Bill Activity Current Year</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="b6d0c4b1-e2d1-40f5-86e6-9715815443bd">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id, fact_bill_activity.bill_amount_vat
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE current_fin_year = 'Current')
 AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
UNION ALL


SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id, null
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE current_fin_year = 'Current') AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
          <EstimatedRows>1141527</EstimatedRows>
        </Partition>
        <Partition dwd:design-time-name="dd3394a0-cb9d-4a19-8927-87ec2303c593">
          <ID>Fact Bill Activity Historical</ID>
          <Name>Fact Bill Activity 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="0504c27e-0969-4403-86b5-8ce05d0e747a">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id, fact_bill_activity.bill_amount_vat
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)
AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
UNION ALL


SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id, null
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="d10b9467-f5ee-480d-bf4a-9657e96eb174">
          <ID>Fact Bill Activity 3 and 4 years old</ID>
          <Name>Fact Bill Activity 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="ba863d13-9c32-496e-b246-2cffe075f64a">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id, fact_bill_activity.bill_amount_vat
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)
AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
UNION ALL


SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id, null
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="a16b1ba5-0fa2-4dee-8344-c8b30c54f345">
          <ID>Fact Bill Activity 5 and 6 years old</ID>
          <Name>Fact Bill Activity 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="b1478bef-5fc2-4e20-9897-d08d64b51410">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id, fact_bill_activity.bill_amount_vat
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)
AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
UNION ALL


SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id, null
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="f5b53e0e-d0c9-422b-b3f5-39ec762f5289">
          <ID>Fact Bill Activity 7 and 8 years old</ID>
          <Name>Fact Bill Activity 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="578ca9f9-c404-4b87-976a-4c73d9558f83">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id, fact_bill_activity.bill_amount_vat
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)
AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
UNION ALL

SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id, null
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="f925f454-97d5-44dc-b978-617802778e20">
          <ID>Fact Bill Activity great than 8 years old</ID>
          <Name>Fact Bill Activity great than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="e2610d9e-0cc1-4366-b6f3-bdd8505fed2b">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id, fact_bill_activity.bill_amount_vat
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' ))
AND dim_bill_date_key &gt;= '20100501'
 AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
UNION ALL


SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id, null
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key In (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' ))
AND dim_orig_posting_date_key &gt;= '20100501' AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
      <AggregationDesigns>
        <AggregationDesign>
          <ID>fact_bill_activity</ID>
          <Name>fact_bill_activity</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <Aggregations>
            <Aggregation>
              <ID>QueryLogAgg_0</ID>
              <Name>QueryLogAgg_0</Name>
              <Dimensions>
                <Dimension>
                  <CubeDimensionID>Client Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Sector</AttributeID>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Sub Sector</AttributeID>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Segment</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Employees</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Hierarchylevel2hist</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
              </Dimensions>
            </Aggregation>
            <Aggregation>
              <ID>QueryLogAgg_1</ID>
              <Name>QueryLogAgg_1</Name>
              <Dimensions>
                <Dimension>
                  <CubeDimensionID>Bill Date</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Date Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
              </Dimensions>
            </Aggregation>
            <Aggregation>
              <ID>QueryLogAgg_2</ID>
              <Name>QueryLogAgg_2</Name>
              <Dimensions>
                <Dimension>
                  <CubeDimensionID>Bill Date</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Date Key</AttributeID>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Date Age Group 2</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Bill Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Bill Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Client Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Client Code</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Employees</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Hierarchylevel2hist</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Matter Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Matter Header Curr Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Master Client Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Client Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Employees 1</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Fed Hierarchy History Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
              </Dimensions>
            </Aggregation>
          </Aggregations>
        </AggregationDesign>
      </AggregationDesigns>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Budget Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="6d46b0d2-6562-45de-877e-cfe4174c3913">
          <ID>Fact Budget Activity</ID>
          <Name>Fact Budget Current</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="2f701c11-bdea-4e01-a1a1-bd324164783a">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT *
from fact_budget_activity_finance_cube
WHERE     (dim_gl_date_key &gt;= 20190501)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="eaf519b4-1b60-4d64-b317-200f3735bc72">
          <ID>Fact Budget Historical</ID>
          <Name>Fact Budget Historical</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="5adba4fa-5e45-4abd-a72d-5c77168ed107">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT *
from fact_budget_activity_finance_cube

WHERE     dim_gl_date_key &gt;= 20100501
 and dim_gl_date_key &lt; 20190501</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Wip</ID>
      <Partitions>
        <Partition dwd:design-time-name="ee77fddd-6151-4b4c-9454-3d8f4098a6f4">
          <ID>Fact Wip</ID>
          <Name>Fact Wip 2020</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="b10c8a2a-ad5e-4f5f-9746-84ffcae36211">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2020)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="2ac3459b-410f-4bc6-8713-73f28651f667">
          <ID>Fact Wip Historical</ID>
          <Name>Fact Wip 2019</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="7a706218-f12a-42b2-b080-70e4a7f92864">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2019)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="7372a24e-3780-4b7c-af2d-14b097f8a74a">
          <ID>Fact Wip 2021</ID>
          <Name>Fact Wip 2021</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="581f8c47-9af6-4626-996d-b73fa2e67801">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2021)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="f64ab563-303a-4e16-af6f-7f6e0d9b9583">
          <ID>Fact Wip 2022</ID>
          <Name>Fact Wip 2022</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="fb653d13-c3dd-4a33-8cf7-c288256d208e">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2022)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="0d1893b7-4983-4301-9548-aa759783ed7e">
          <ID>Fact Wip 2023</ID>
          <Name>Fact Wip 2023</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="6c604f81-a3e1-4a64-a051-3c63f691679c">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2023)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Bill Billed Time Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="35b2c561-1034-4609-9a3b-d0abe523d64f">
          <ID>Fact Bill Billed Time Activity</ID>
          <Name>Fact Bill Billed Time Activity Current</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="13b4048f-2cc5-4cc1-8135-718a13cf6ee4">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE  current_fin_year = 'Current' AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="4f5f4ff4-8805-4671-b50b-18541d764be0">
          <ID>Fact Bill Billed Time Activity 1</ID>
          <Name>Fact Bill Billed Time 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="00cd4146-5512-4ad3-b416-80363e74bf43">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)  AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="0b30b610-c690-432b-8082-5355fd41c518">
          <ID>Fact Bill Billed Time Activity 3 and 4 years old</ID>
          <Name>Fact Bill Billed Time 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="97b083c8-2be0-4b48-9886-3f00d9d3cbe9">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="01dfdb3e-263b-491a-bee4-02204bee1650">
          <ID>Fact Bill Billed Time 5 and 6 years old</ID>
          <Name>Fact Bill Billed Time 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="78cc93b6-0553-49e1-9f83-9df56a873757">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="4785752e-f2e4-4311-80ab-c12906009906">
          <ID>Fact Bill Billed Time 7 and 8 years old</ID>
          <Name>Fact Bill Billed Time 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="1ac0800a-1076-4160-b115-6ee0535ced4c">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="f6385c69-b28b-4d1e-b12d-34d3f99cb857">
          <ID>Fact Bill Billed Time great than 8 years old</ID>
          <Name>Fact Bill Billed Time great than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="3a9a154f-ddb5-4606-8c3b-887a600872e6">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' ) 
AND  (fact_bill_billed_time_activity.dim_gl_date_key &gt;= 20100501) AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Billable Time Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="8569538c-0eaf-496e-b35b-4fe30f0bf621">
          <ID>Fact Billable Time Activity</ID>
          <Name>Fact Billable Time Activity Current</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="bdab337c-3365-4dfc-8135-6f756f10ace2">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
			,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min,
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0, fact_costs_rates.staff_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_staff_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.other_costs_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_other_cost_rate, 
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.total_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_total_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.establishment_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_establishment_cost_rate
			 
			 ,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
AND current_fin_year = 'Current'
AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id	, dim_client.client_name</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="634e1498-b054-4df6-97e8-a21f8c18f116">
          <ID>Fact Billable Time Activity Historical</ID>
          <Name>Fact Billable Time 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="12f44a53-61d6-461c-bfda-074793f04b88">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
			,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min,
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0, fact_costs_rates.staff_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_staff_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.other_costs_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_other_cost_rate, 
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.total_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_total_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.establishment_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_establishment_cost_rate
			 
			 ,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)
AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id	, dim_client.client_name</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="183e49aa-d22f-4770-8185-d4db7284a7de">
          <ID>Fact Billable Time 2 and 3 years old</ID>
          <Name>Fact Billable Time 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="69ff298a-d8cd-4658-87b7-b698653b7c90">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
			,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min,
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0, fact_costs_rates.staff_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_staff_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.other_costs_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_other_cost_rate, 
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.total_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_total_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.establishment_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_establishment_cost_rate
			 
			 ,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)
AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id	, dim_client.client_name</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="a9801463-30e3-4457-98f2-f810e0fa97aa">
          <ID>Fact Billable Time 5 and 6 years old</ID>
          <Name>Fact Billable Time 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="4a0cf3e0-e9c1-44cb-9cd9-ab64957f19df">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
			,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min,
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0, fact_costs_rates.staff_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_staff_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.other_costs_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_other_cost_rate, 
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.total_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_total_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.establishment_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_establishment_cost_rate
			 
			 ,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)
AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id	, dim_client.client_name</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="dc06171f-f921-4b71-a353-4b8f123cf7ee">
          <ID>Fact Billable Time 7 and 8 years old</ID>
          <Name>Fact Billable Time 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="31585c1e-8f24-4ebe-b9ef-22c979945a3f">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
			,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min,
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0, fact_costs_rates.staff_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_staff_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.other_costs_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_other_cost_rate, 
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.total_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_total_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.establishment_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_establishment_cost_rate
			 
			 ,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)
AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id	, dim_client.client_name</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="85c07fd3-44ea-4050-bda2-88fd09469589">
          <ID>Fact Billable Time greater than 8 years old</ID>
          <Name>Fact Billable Time greater than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="90f645ba-5645-4b78-8c03-b3e3ce40ba90">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
			,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min,
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0, fact_costs_rates.staff_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_staff_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.other_costs_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_other_cost_rate, 
			 iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.total_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_total_cost_rate, 
             iif(dim_client.client_name in ('Weightmans LLP','Weightmans Marketing','Weightmans Commercial'), 0,fact_costs_rates.establishment_cost_rate) * (sum(fact_billable_time_activity.minutes_recorded) / 60) AS chargeable_hours_establishment_cost_rate
			 
			 ,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND (fact_billable_time_activity.dim_orig_posting_date_key &gt;= 20100501)
AND ISNULL(finance_reporting_exclusion,'') &lt;&gt; 1
GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id	, dim_client.client_name</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Debt Monthly</ID>
      <Partitions>
        <Partition dwd:design-time-name="232896e0-df9f-48a9-b142-9a48eb2d981d">
          <ID>Fact Debt Monthly</ID>
          <Name>Fact Debt Monthly 2020</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="31b62762-0232-480f-b18c-529679362103">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2020)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="dfe193e4-7b2a-4298-9067-601bb56b9270">
          <ID>Fact Debt Monthly 1</ID>
          <Name>Fact Debt Monthly 2019</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="e297062e-489f-4415-b43e-057b8b76b015">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2019)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="86add2b7-c360-41d6-bd5b-f8315786eda2">
          <ID>Fact Debt Monthly 2021</ID>
          <Name>Fact Debt Monthly 2021</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="5888e68e-5f6a-4474-9895-daa921c69ad8">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2021)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="8c2e2d74-2aa1-475e-8563-e9fe4a5b135f">
          <ID>Fact Debt Monthly 2022</ID>
          <Name>Fact Debt Monthly 2022</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="fb6a2bb5-e40f-42e8-8ea6-6d0e9f28c26e">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2022)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="01f1555e-cbb0-4bae-8ca6-dd10916f5168">
          <ID>Fact Debt Monthly 2023</ID>
          <Name>Fact Debt Monthly 2023</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="e7098ba5-6d31-4f37-b5d3-85c0b7b5ee08">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2023)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
      <AggregationDesigns>
        <AggregationDesign>
          <ID>AggregationDesign</ID>
          <Name>AggregationDesign</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <EstimatedRows>211640</EstimatedRows>
          <Dimensions>
            <Dimension>
              <CubeDimensionID>Bill Details</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Bill Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Matter Details</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Matter Header Curr Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Client Details</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Client Code</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Bill Date</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Date Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Age Banding</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Age Banding</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Employees 1</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Fed Hierarchy History Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Dibs WIP and Debt Snapshot</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Snapshot Date</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
          </Dimensions>
        </AggregationDesign>
      </AggregationDesigns>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Disbursements Detail Monthly</ID>
      <Partitions>
        <Partition dwd:design-time-name="a17b74af-9d19-4b12-8e21-522c0b3557cd">
          <ID>Fact Disbursements Detail Monthly</ID>
          <Name>Fact Disbursements Detail Monthly 2019</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="7615acce-bdb8-40ee-9392-7e7dcdcda1f4">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, fact_disbursements_detail_monthly.source_system_id
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2019)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key ,   ISNULL(dim_client.client_code, 'Unknown'), fact_dimension_main.client_code, fact_disbursements_detail_monthly.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="64db8578-e42b-40ab-9718-805781af366a">
          <ID>Fact Disbursements Detail Monthly Historical</ID>
          <Name>Fact Disbursements Detail Monthly 2020</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="e9390437-ad55-42d1-896a-514fbc747018">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, fact_disbursements_detail_monthly.source_system_id
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2020)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key,  ISNULL(dim_client.client_code, 'Unknown'),  fact_dimension_main.client_code, fact_disbursements_detail_monthly.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="8414f94e-3b3b-483c-8659-3a8830824c1a">
          <ID>Fact Disbursements Detail Monthly 2021</ID>
          <Name>Fact Disbursements Detail Monthly 2021</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="5ca38540-4bae-48b3-8ea2-f715f50ea20c">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, fact_disbursements_detail_monthly.source_system_id
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2021)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, ISNULL(dim_client.client_code, 'Unknown'), fact_dimension_main.dim_fed_hierarchy_history_key, fact_dimension_main.client_code, fact_disbursements_detail_monthly.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="6c90f3f0-cf5c-4790-bb97-39789b72042f">
          <ID>Fact Disbursements Detail Monthly 2022</ID>
          <Name>Fact Disbursements Detail Monthly 2022</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="7375cccb-eff6-4514-a992-471e56614fa5">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, fact_disbursements_detail_monthly.source_system_id
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2022)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_dimension_main.client_code, fact_disbursements_detail_monthly.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="ce2e70b4-0500-4d90-a796-be63f0c2db94">
          <ID>Fact Disbursements Detail Monthly 2023</ID>
          <Name>Fact Disbursements Detail Monthly 2023</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="1c2bce6a-a935-4a4d-82b8-2051f3b59f91">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, fact_disbursements_detail_monthly.source_system_id
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2023)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'),   fact_dimension_main.client_code, fact_disbursements_detail_monthly.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Write Off</ID>
      <Partitions>
        <Partition dwd:design-time-name="790cdc9c-2b64-422d-8782-cbb793938fc8">
          <ID>Fact Write Off</ID>
          <Name>Fact Write Off</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="DsvTableBinding" dwd:design-time-name="97796a55-a6b9-4fdd-9266-cdeb3141352f">
            <DataSourceViewID>FinanceDataSource</DataSourceViewID>
            <TableID>dbo_fact_write_off</TableID>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Bill Write Off</ID>
      <Partitions>
        <Partition dwd:design-time-name="a3c2f2f0-75d9-4313-9925-641b3b70b686">
          <ID>Fact Bill Write Off</ID>
          <Name>Fact Bill Write Off</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="DsvTableBinding" dwd:design-time-name="44d71c5f-8cf1-4cb7-80b2-51763787f379">
            <DataSourceViewID>FinanceDataSource</DataSourceViewID>
            <TableID>dbo_fact_bill_write_off</TableID>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
  </MeasureGroups>
</Cube>