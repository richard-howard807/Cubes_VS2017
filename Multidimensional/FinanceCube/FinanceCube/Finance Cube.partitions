<Cube xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ddl2="http://schemas.microsoft.com/analysisservices/2003/engine/2" xmlns:ddl2_2="http://schemas.microsoft.com/analysisservices/2003/engine/2/2" xmlns:ddl100_100="http://schemas.microsoft.com/analysisservices/2008/engine/100/100" xmlns:ddl200="http://schemas.microsoft.com/analysisservices/2010/engine/200" xmlns:ddl200_200="http://schemas.microsoft.com/analysisservices/2010/engine/200/200" xmlns:ddl300="http://schemas.microsoft.com/analysisservices/2011/engine/300" xmlns:ddl300_300="http://schemas.microsoft.com/analysisservices/2011/engine/300/300" xmlns:ddl400="http://schemas.microsoft.com/analysisservices/2012/engine/400" xmlns:ddl400_400="http://schemas.microsoft.com/analysisservices/2012/engine/400/400" xmlns:ddl500="http://schemas.microsoft.com/analysisservices/2013/engine/500" xmlns:ddl500_500="http://schemas.microsoft.com/analysisservices/2013/engine/500/500" xmlns:dwd="http://schemas.microsoft.com/DataWarehouse/Designer/1.0" dwd:design-time-name="3feb29eb-17d5-4b74-a911-2f02623beb59" xmlns="http://schemas.microsoft.com/analysisservices/2003/engine">
  <ID>Finance Cube</ID>
  <MeasureGroups>
    <MeasureGroup>
      <ID>Fact Bill</ID>
      <Partitions>
        <Partition dwd:design-time-name="b8708257-ddc2-40a9-8e92-78b647208720">
          <ID>Fact Bill</ID>
          <Name>Fact Bill Current Year</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="6982e5a7-798f-4e56-82f3-2a5d321b312a">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   current_fin_year = 'Current'</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
          <EstimatedRows>1836255</EstimatedRows>
        </Partition>
        <Partition dwd:design-time-name="28da4c3d-70e8-4cfb-a15c-42e19b09b309">
          <ID>Fact Bill 1</ID>
          <Name>Fact Bill 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="e613de4b-5639-4d79-8af5-02ddf1d5c6d4">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						 
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current')  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current')</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="b215664a-d189-4bf0-97d9-082be2e0072f">
          <ID>Fact Bill 3 and 4 years old</ID>
          <Name>Fact Bill 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="3051d18f-6e41-4310-8af7-6a5f263accf8">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="7f6818d4-99f2-4f1a-b101-c75f917ac7ae">
          <ID>Fact Bill 5 and 6 years old</ID>
          <Name>Fact Bill 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="1943b12d-745d-4f40-81a4-0c28ef3e2bd9">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="79720f22-6db7-4079-815d-185f3a92db51">
          <ID>Fact Bill 7 and 8 years old</ID>
          <Name>Fact Bill 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="d9c2e1d1-8e5a-42c5-b126-d8e63d412bff">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="8f187a1c-148d-417d-95f6-9cb2310ad335">
          <ID>Fact Bill greater than 8 years old</ID>
          <Name>Fact Bill greater than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="495f0a21-e675-4bfa-a25d-07fe372763e3">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  
AND  (fact_bill.dim_bill_date_key &gt;= 20100501)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Bill Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="f73539b4-ea8f-4f6a-8040-af64402ad0ee">
          <ID>Fact Bill Activity</ID>
          <Name>Fact Bill Activity Current Year</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="357d752a-4c76-4e48-b61c-770a25509ce4">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE current_fin_year = 'Current')

UNION ALL


SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE current_fin_year = 'Current')</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
          <EstimatedRows>1141527</EstimatedRows>
        </Partition>
        <Partition dwd:design-time-name="83d47544-a849-4a69-8ed0-1060a3e96478">
          <ID>Fact Bill Activity Historical</ID>
          <Name>Fact Bill Activity 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="e8ba2704-6604-4569-a327-7446f8afa267">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)

UNION ALL


SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="6d27f893-9afb-4036-931f-bc52712ee958">
          <ID>Fact Bill Activity 3 and 4 years old</ID>
          <Name>Fact Bill Activity 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="bbc74f32-4068-4754-8a78-3db0c9a577cc">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)

UNION ALL


SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="5676838b-5530-49e2-8a08-84e6f0742b04">
          <ID>Fact Bill Activity 5 and 6 years old</ID>
          <Name>Fact Bill Activity 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="6aea30af-e594-4a50-9470-746738fcaf91">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)

UNION ALL


SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="51d970de-3ddb-430e-a34a-56409d663f2b">
          <ID>Fact Bill Activity 7 and 8 years old</ID>
          <Name>Fact Bill Activity 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="0e03dff0-ef52-42e6-a826-08cbffe6f3ed">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)

UNION ALL

SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="28313bb0-8835-4810-8ff2-fc8a010921b9">
          <ID>Fact Bill Activity great than 8 years old</ID>
          <Name>Fact Bill Activity great than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="88cbbe53-c742-49d1-a484-ae19e24c0bf1">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key, bill_number, fact_bill_activity.source_system_id
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' ))
AND dim_bill_date_key &gt;= '20100501'

UNION ALL


SELECT    CAST('999' + CAST(fact_billable_time_activity.source_system_id AS VARCHAR(2)) + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1,
		fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_fed_hierarchy_history_key, 
             fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key, ISNULL(dim_client_1.client_code, 'Unknown') AS master_client_code, 
				ISNULL(fact_dimension_main_1.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, '0' AS EXPR4, fact_billable_time_activity.source_system_id
FROM     fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE), GETDATE()) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND dim_days_banding_1.banding_category = 'grouping3' 
			 LEFT outer JOIN
             fact_dimension_main AS fact_dimension_main_1 ON fact_dimension_main_1.dim_matter_header_curr_key = fact_billable_time_activity.dim_matter_header_curr_key
						AND fact_billable_time_activity.source_system_id = fact_dimension_main_1.source_system_id
			 LEFT OUTER JOIN
             dim_client AS dim_client_1 ON dim_client_1.client_code = CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   (fact_billable_time_activity.dim_bill_key = 0)
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key In (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' ))
AND dim_orig_posting_date_key &gt;= '20100501'</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
      <AggregationDesigns>
        <AggregationDesign>
          <ID>fact_bill_activity</ID>
          <Name>fact_bill_activity</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <Aggregations>
            <Aggregation>
              <ID>QueryLogAgg_0</ID>
              <Name>QueryLogAgg_0</Name>
              <Dimensions>
                <Dimension>
                  <CubeDimensionID>Client Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Sector</AttributeID>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Sub Sector</AttributeID>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Segment</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Employees</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Hierarchylevel2hist</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
              </Dimensions>
            </Aggregation>
            <Aggregation>
              <ID>QueryLogAgg_1</ID>
              <Name>QueryLogAgg_1</Name>
              <Dimensions>
                <Dimension>
                  <CubeDimensionID>Bill Date</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Date Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
              </Dimensions>
            </Aggregation>
            <Aggregation>
              <ID>QueryLogAgg_2</ID>
              <Name>QueryLogAgg_2</Name>
              <Dimensions>
                <Dimension>
                  <CubeDimensionID>Bill Date</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Date Key</AttributeID>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Date Age Group 2</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Bill Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Bill Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Client Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Client Code</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Employees</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Hierarchylevel2hist</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Matter Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Matter Header Curr Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Master Client Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Client Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Employees 1</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Fed Hierarchy History Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
              </Dimensions>
            </Aggregation>
          </Aggregations>
        </AggregationDesign>
      </AggregationDesigns>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Budget Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="5a803577-6756-422f-86ae-7bad94f1e097">
          <ID>Fact Budget Activity</ID>
          <Name>Fact Budget Current</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="ce29321f-563e-4f91-9101-a1594decc290">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT *
from fact_budget_activity_finance_cube
WHERE     (dim_gl_date_key &gt;= 20190501)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="e40948db-b871-4f6d-9584-2a7a973e20b8">
          <ID>Fact Budget Historical</ID>
          <Name>Fact Budget Historical</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="164428f3-ba5f-4c47-9604-816ff2ef68ee">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT *
from fact_budget_activity_finance_cube

WHERE     dim_gl_date_key &gt;= 20100501
 and dim_gl_date_key &lt; 20190501</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Wip</ID>
      <Partitions>
        <Partition dwd:design-time-name="ea65b375-4a26-4f6c-880c-5d2376793a94">
          <ID>Fact Wip</ID>
          <Name>Fact Wip 2020</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="eff7799a-cc12-4783-923f-002fc8f61b10">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2020)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="0bba6b52-b1ea-4758-92f0-ebe25d5ffeec">
          <ID>Fact Wip Historical</ID>
          <Name>Fact Wip 2019</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="a5124c71-5360-474c-b4c9-9f7599920b43">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2019)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="16fa7020-63ad-49cc-82f6-297f5d999a80">
          <ID>Fact Wip 2021</ID>
          <Name>Fact Wip 2021</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="288dadbe-3f3b-4860-9131-406cea46681c">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2021)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="2ebcd029-dec9-4cc0-baba-9cd4587b785c">
          <ID>Fact Wip 2022</ID>
          <Name>Fact Wip 2022</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="4feca899-a9a8-473e-8f1e-d72ca7316220">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2022)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="073d5986-dcde-4ecf-bb62-be809dd87ce3">
          <ID>Fact Wip 2023</ID>
          <Name>Fact Wip 2023</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="558a0e22-6c23-4932-8ed0-557c99c9c848">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2023)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Bill Billed Time Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="d3991a29-9d00-48c4-a81d-fc98a88c09b9">
          <ID>Fact Bill Billed Time Activity</ID>
          <Name>Fact Bill Billed Time Activity Current</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="e27296dd-0eb9-44d1-89d1-9325a4cb766f">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE  current_fin_year = 'Current'
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="46f1db91-79dd-47ce-be76-49031504fc08">
          <ID>Fact Bill Billed Time Activity 1</ID>
          <Name>Fact Bill Billed Time 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="07fea008-be52-4403-8991-ee4bcddd81cd">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="1ebe992d-1369-42f5-b4f8-c5e60a566669">
          <ID>Fact Bill Billed Time Activity 3 and 4 years old</ID>
          <Name>Fact Bill Billed Time 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="68accb9e-6cd0-4621-a40c-bfab0ee0dff2">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="3d2d944d-d93c-4658-9d35-158b84ded94d">
          <ID>Fact Bill Billed Time 5 and 6 years old</ID>
          <Name>Fact Bill Billed Time 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="98c6412a-f277-4e03-a024-461f790c2b21">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="a4473f5b-2644-4116-a3e4-f69f717ae684">
          <ID>Fact Bill Billed Time 7 and 8 years old</ID>
          <Name>Fact Bill Billed Time 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="92c106f4-c3a2-4d8b-8489-49873e95e6ca">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="b6a02575-1ac9-4bac-b789-7a485be6bd13">
          <ID>Fact Bill Billed Time great than 8 years old</ID>
          <Name>Fact Bill Billed Time great than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="b0c5a416-9f49-4f65-a260-969e4f79914c">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded, fact_bill_billed_time_activity.source_system_id
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' ) 
AND  (fact_bill_billed_time_activity.dim_gl_date_key &gt;= 20100501)
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_bill_billed_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Billable Time Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="6b1ae39e-58e8-474a-b15a-2fd8034c232e">
          <ID>Fact Billable Time Activity</ID>
          <Name>Fact Billable Time Activity Current</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="97eba803-84c9-4d50-ad3d-7ac60f12f42a">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate ,establishment_cost_rate * SUM((fact_billable_time_activity.minutes_recorded / 60)) AS chargeable_hours_establishment_cost_rate,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
AND current_fin_year = 'Current'

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="197ee4e2-67ac-4d3c-b4b6-c5e7354c92a4">
          <ID>Fact Billable Time Activity Historical</ID>
          <Name>Fact Billable Time 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="4cc7fa6f-9ad2-4136-a330-892d37899cbb">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min
			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate			 ,establishment_cost_rate * SUM((fact_billable_time_activity.minutes_recorded / 60)) AS chargeable_hours_establishment_cost_rate,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="f35d03da-2210-46f5-bead-a1b1e2fd449b">
          <ID>Fact Billable Time 2 and 3 years old</ID>
          <Name>Fact Billable Time 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="aac33962-b26c-432a-9bc6-efd1c384b368">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min
			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate ,establishment_cost_rate * SUM((fact_billable_time_activity.minutes_recorded / 60)) AS chargeable_hours_establishment_cost_rate,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="8f62f472-7107-4cbb-a0e3-579dd4382521">
          <ID>Fact Billable Time 5 and 6 years old</ID>
          <Name>Fact Billable Time 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="ced6b1a0-ffcd-4bc0-9582-749a79c032e2">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min ,establishment_cost_rate * SUM((fact_billable_time_activity.minutes_recorded / 60)) AS chargeable_hours_establishment_cost_rate,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="2b590204-3fad-4045-956d-ee4296fec8c9">
          <ID>Fact Billable Time 7 and 8 years old</ID>
          <Name>Fact Billable Time 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="57f4130d-96ea-464e-a0a0-e3018d4c2224">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min
			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate ,establishment_cost_rate * SUM((fact_billable_time_activity.minutes_recorded / 60)) AS chargeable_hours_establishment_cost_rate,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="ab59cfce-d42d-46d5-9031-622f8799f824">
          <ID>Fact Billable Time greater than 8 years old</ID>
          <Name>Fact Billable Time greater than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="db712884-7f58-4aeb-bbac-892ec23c2f4f">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min
			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate ,establishment_cost_rate * SUM((fact_billable_time_activity.minutes_recorded / 60)) AS chargeable_hours_establishment_cost_rate,fact_billable_time_activity.source_system_id
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND (fact_billable_time_activity.dim_orig_posting_date_key &gt;= 20100501)

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min, establishment_cost_rate,fact_billable_time_activity.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Debt Monthly</ID>
      <Partitions>
        <Partition dwd:design-time-name="b43253e1-0e6d-41e7-bf71-b5cdb402989f">
          <ID>Fact Debt Monthly</ID>
          <Name>Fact Debt Monthly 2020</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="cad4e6cd-2524-4486-94f5-8fa9ed661d6e">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2020)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="2dce3b3b-36d8-4075-a025-8fdc4c8b5f39">
          <ID>Fact Debt Monthly 1</ID>
          <Name>Fact Debt Monthly 2019</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="fba2c2c8-5a88-4266-bc67-410dddebc91a">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2019)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="2de9269c-6ddf-4050-afe6-852b37f7ca23">
          <ID>Fact Debt Monthly 2021</ID>
          <Name>Fact Debt Monthly 2021</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="b1ea6366-e8ea-4b1b-8aec-baaf76cc823a">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2021)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="9cbd6570-a080-44b8-83bf-a55243952019">
          <ID>Fact Debt Monthly 2022</ID>
          <Name>Fact Debt Monthly 2022</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="0f628820-ef29-412b-9fe9-61e043ad4c07">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2022)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="a6ebaaed-da9d-4fc1-b1f7-7653691b9c7a">
          <ID>Fact Debt Monthly 2023</ID>
          <Name>Fact Debt Monthly 2023</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="b61ef563-f0c5-4ddb-8147-6e97da9c34c4">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2023)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
      <AggregationDesigns>
        <AggregationDesign>
          <ID>AggregationDesign</ID>
          <Name>AggregationDesign</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <EstimatedRows>211640</EstimatedRows>
          <Dimensions>
            <Dimension>
              <CubeDimensionID>Bill Details</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Bill Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Matter Details</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Matter Header Curr Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Client Details</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Client Code</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Bill Date</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Date Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Age Banding</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Age Banding</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Employees 1</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Fed Hierarchy History Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Dibs WIP and Debt Snapshot</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Snapshot Date</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
          </Dimensions>
        </AggregationDesign>
      </AggregationDesigns>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Disbursements Detail Monthly</ID>
      <Partitions>
        <Partition dwd:design-time-name="bf348f47-c65b-4766-b90c-a19e20fc45a3">
          <ID>Fact Disbursements Detail Monthly</ID>
          <Name>Fact Disbursements Detail Monthly 2019</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="72c49d5b-2264-4739-9081-cf7b9ef34c78">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, fact_disbursements_detail_monthly.source_system_id
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2019)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key ,   ISNULL(dim_client.client_code, 'Unknown'), fact_dimension_main.client_code, fact_disbursements_detail_monthly.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="59ec9392-b2cb-4ae7-96e2-02591c35b02e">
          <ID>Fact Disbursements Detail Monthly Historical</ID>
          <Name>Fact Disbursements Detail Monthly 2020</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="652268af-dfb0-4595-a53f-0e9febc3427e">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, fact_disbursements_detail_monthly.source_system_id
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2020)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key,  ISNULL(dim_client.client_code, 'Unknown'),  fact_dimension_main.client_code, fact_disbursements_detail_monthly.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="d4022aff-e223-47d1-b2e3-1bf936b3627d">
          <ID>Fact Disbursements Detail Monthly 2021</ID>
          <Name>Fact Disbursements Detail Monthly 2021</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="1e0b91a9-fbb1-4a50-b7ca-0c57884d6058">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, fact_disbursements_detail_monthly.source_system_id
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2021)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, ISNULL(dim_client.client_code, 'Unknown'), fact_dimension_main.dim_fed_hierarchy_history_key, fact_dimension_main.client_code, fact_disbursements_detail_monthly.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="2cbf21f6-94c7-4d8c-9263-e6176af24a4b">
          <ID>Fact Disbursements Detail Monthly 2022</ID>
          <Name>Fact Disbursements Detail Monthly 2022</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="ff4ba865-c909-4642-b2e0-9087c399c6f3">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, fact_disbursements_detail_monthly.source_system_id
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2022)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_dimension_main.client_code, fact_disbursements_detail_monthly.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="28b0b603-7e3c-4ff0-996c-5e8aa475f405">
          <ID>Fact Disbursements Detail Monthly 2023</ID>
          <Name>Fact Disbursements Detail Monthly 2023</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="c0ded49d-07e2-426e-b2f9-3da9ca5857e7">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key, fact_disbursements_detail_monthly.source_system_id
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2023)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'),   fact_dimension_main.client_code, fact_disbursements_detail_monthly.source_system_id</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Write Off</ID>
      <Partitions>
        <Partition dwd:design-time-name="d66a82a3-4ed3-45d5-ae2d-17fab14cb13e">
          <ID>Fact Write Off</ID>
          <Name>Fact Write Off</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="DsvTableBinding" dwd:design-time-name="0372aca9-5db7-4b0e-91e2-df08c3c0e9f0">
            <DataSourceViewID>FinanceDataSource</DataSourceViewID>
            <TableID>dbo_fact_write_off</TableID>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
  </MeasureGroups>
</Cube>