<Cube xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ddl2="http://schemas.microsoft.com/analysisservices/2003/engine/2" xmlns:ddl2_2="http://schemas.microsoft.com/analysisservices/2003/engine/2/2" xmlns:ddl100_100="http://schemas.microsoft.com/analysisservices/2008/engine/100/100" xmlns:ddl200="http://schemas.microsoft.com/analysisservices/2010/engine/200" xmlns:ddl200_200="http://schemas.microsoft.com/analysisservices/2010/engine/200/200" xmlns:ddl300="http://schemas.microsoft.com/analysisservices/2011/engine/300" xmlns:ddl300_300="http://schemas.microsoft.com/analysisservices/2011/engine/300/300" xmlns:ddl400="http://schemas.microsoft.com/analysisservices/2012/engine/400" xmlns:ddl400_400="http://schemas.microsoft.com/analysisservices/2012/engine/400/400" xmlns:ddl500="http://schemas.microsoft.com/analysisservices/2013/engine/500" xmlns:ddl500_500="http://schemas.microsoft.com/analysisservices/2013/engine/500/500" xmlns:dwd="http://schemas.microsoft.com/DataWarehouse/Designer/1.0" dwd:design-time-name="a74ff91a-0393-4c56-b337-f630068b97b1" xmlns="http://schemas.microsoft.com/analysisservices/2003/engine">
  <ID>Finance Cube</ID>
  <MeasureGroups>
    <MeasureGroup>
      <ID>Fact Bill</ID>
      <Partitions>
        <Partition dwd:design-time-name="619797a1-789d-426e-9917-da7f9f06fd86">
          <ID>Fact Bill</ID>
          <Name>Fact Bill Current Year</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="b623f4b6-485b-4c51-953f-5c50af756f5a">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   current_fin_year = 'Current'</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
          <EstimatedRows>1836255</EstimatedRows>
        </Partition>
        <Partition dwd:design-time-name="e4729c38-9047-42a4-a9bf-04281cf9a7c9">
          <ID>Fact Bill 1</ID>
          <Name>Fact Bill 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="2478c950-af74-4a9b-91bf-bae87fb0b082">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						 
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current')  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current')</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="90f1a68c-e0c8-4323-b266-749a0d7af5ac">
          <ID>Fact Bill 3 and 4 years old</ID>
          <Name>Fact Bill 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="26a45080-d78f-41ed-b351-7fdf1de6b7ff">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="7898e1b0-b840-4f55-bd97-37b7b54a7e41">
          <ID>Fact Bill 5 and 6 years old</ID>
          <Name>Fact Bill 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="76b837ed-0ac2-427f-a177-92678aa4a672">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="fd5643d4-281a-41a9-a06a-aeb4cb5d2eb9">
          <ID>Fact Bill 7 and 8 years old</ID>
          <Name>Fact Bill 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="8b2f8c9a-9236-4e57-9739-a02c9aa54e5a">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year BETWEEN (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="2b5a5869-1442-4aa7-97e9-d18eeaeca6ce">
          <ID>Fact Bill greater than 8 years old</ID>
          <Name>Fact Bill greater than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="d022a5e4-50af-47db-b1cf-f6277ee34147">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_bill.dim_matter_header_curr_key, fact_bill.dim_client_key, fact_bill.dim_bill_date_key, fact_bill.dim_bill_key, fact_bill.dim_posting_date_key, fact_bill.dim_last_pay_date_key, 
                         fact_bill.dim_address_key, fact_bill.dim_write_off_codes_key, fact_bill.master_fact_key, fact_bill.source_system_id, fact_bill.client_code, fact_bill.matter_number, fact_bill.bill_number, 
                         fact_bill.bill_sequence, fact_bill.bill_total, fact_bill.fees_total, fact_bill.paid_disbursements, fact_bill.unpaid_disbursements, fact_bill.admin_charges_total, fact_bill.vat_amount, 
                         fact_bill.amount_paid, fact_bill.amount_outstanding, fact_bill.fact_bill_key, fact_bill.dss_update_time, fact_bill.dim_bill_debt_narrative_key, 
                         dim_fed_hierarchy_history.dim_fed_hierarchy_history_key AS matter_owner_history_key, dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM         fact_bill INNER JOIN
                         dim_matter_header_current ON dim_matter_header_current.dim_matter_header_curr_key = fact_bill.dim_matter_header_curr_key INNER JOIN
                         dim_date ON fact_bill.dim_bill_date_key = dim_date.dim_date_key LEFT OUTER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.fed_code = dim_matter_header_current.fee_earner_code AND dim_date.calendar_date BETWEEN 
                         dim_fed_hierarchy_history.dss_start_date AND dim_fed_hierarchy_history.dss_end_date
						 INNER join dim_days_banding on DATEDIFF(d, calendar_date, GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE   fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  
AND  (fact_bill.dim_bill_date_key &gt;= 20100501)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Bill Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="becdac2b-d61d-4a28-8a0f-377f75d0448e">
          <ID>Fact Bill Activity</ID>
          <Name>Fact Bill Activity Current Year</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="ac57f29e-69c5-40a6-ae1e-1bb378110c08">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE current_fin_year = 'Current')

UNION ALL

SELECT CAST('999' + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1, fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, 
             fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key
			 ,ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, GETDATE(), CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE)) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND 
             dim_days_banding_1.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE     (dim_bill_key = 0) 
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE current_fin_year = 'Current')</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
          <EstimatedRows>1141527</EstimatedRows>
        </Partition>
        <Partition dwd:design-time-name="f3cbf25d-732d-42fb-a028-7e4bc48c0802">
          <ID>Fact Bill Activity Historical</ID>
          <Name>Fact Bill Activity 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="5e78208a-e125-45d6-8565-961498ff4aa9">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)

UNION ALL

SELECT CAST('999' + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1, fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, 
             fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key
			 ,ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, GETDATE(), CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE)) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND 
             dim_days_banding_1.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE     (dim_bill_key = 0) 
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="65057f66-6a1c-41da-aea1-a0943752bf1c">
          <ID>Fact Bill Activity 3 and 4 years old</ID>
          <Name>Fact Bill Activity 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="ff3303fa-0c66-4436-bda0-495a07387bc2">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)

UNION ALL

SELECT CAST('999' + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1, fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, 
             fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key
			 ,ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, GETDATE(), CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE)) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND 
             dim_days_banding_1.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE     (dim_bill_key = 0) 
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="671acb96-fdf4-4520-970b-3661d70a5e30">
          <ID>Fact Bill Activity 5 and 6 years old</ID>
          <Name>Fact Bill Activity 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="4d0fd39f-3a42-4e29-a26b-c3011ae5fac3">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)

UNION ALL

SELECT CAST('999' + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1, fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, 
             fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key
			 ,ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, GETDATE(), CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE)) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND 
             dim_days_banding_1.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE     (dim_bill_key = 0) 
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="a19cd5ad-beb7-4804-ad22-d25136e30e9d">
          <ID>Fact Bill Activity 7 and 8 years old</ID>
          <Name>Fact Bill Activity 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="e1a5a108-5325-43ca-ba20-b7d42e8167a6">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)

UNION ALL

SELECT CAST('999' + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1, fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, 
             fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key
			 ,ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, GETDATE(), CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE)) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND 
             dim_days_banding_1.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE     (dim_bill_key = 0) 
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year BETWEEN  (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="744275b8-fd05-42c3-9f58-1c535daf2b87">
          <ID>Fact Bill Activity great than 8 years old</ID>
          <Name>Fact Bill Activity great than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="9a95d599-4555-4f24-879d-7a90521284e3">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT CAST(fact_bill_activity.fact_bill_activity_key AS BIGINT) AS fact_bill_activity_key, fact_bill_activity.dim_client_key, fact_bill_activity.dim_bill_date_key, fact_bill_activity.dim_bill_key, fact_bill_activity.dim_fed_hierarchy_history_key, fact_bill_activity.dim_matter_header_curr_key, 
             fact_bill_activity.billed_time, fact_bill_activity.bill_amount, dim_days_banding.dim_days_banding_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_bill_activity INNER JOIN
             dim_days_banding ON DATEDIFF(d, GETDATE(), fact_bill_activity.gldate) BETWEEN dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
				CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
WHERE     dim_bill_date_key IN (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' ))
AND dim_bill_date_key &gt;= '20100501'

UNION ALL

SELECT CAST('999' + CAST(fact_billable_time_activity.transaction_sequence_number AS VARCHAR(25)) AS bigint) AS EXPR1, fact_billable_time_activity.dim_client_key, fact_billable_time_activity.dim_orig_posting_date_key, fact_billable_time_activity.dim_bill_key, 
             fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, NULL AS EXPR2, NULL AS EXPR3, dim_days_banding_1.dim_days_banding_key
			 ,ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key
FROM   fact_billable_time_activity INNER JOIN
             dim_days_banding AS dim_days_banding_1 ON DATEDIFF(d, GETDATE(), CAST(CONVERT(CHAR(10), fact_billable_time_activity.dim_orig_posting_date_key, 120) AS DATE)) BETWEEN dim_days_banding_1.startdays AND dim_days_banding_1.enddays AND 
             dim_days_banding_1.banding_category = 'grouping3'
	left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE     (dim_bill_key = 0) 
AND (dim_orig_posting_date_key IS NOT NULL)
and     dim_orig_posting_date_key In (SELECT dim_date_key FROM dbo.dim_date WHERE fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' ))
AND dim_orig_posting_date_key &gt;= '20100501'</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
      <AggregationDesigns>
        <AggregationDesign>
          <ID>fact_bill_activity</ID>
          <Name>fact_bill_activity</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <Aggregations>
            <Aggregation>
              <ID>QueryLogAgg_0</ID>
              <Name>QueryLogAgg_0</Name>
              <Dimensions>
                <Dimension>
                  <CubeDimensionID>Client Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Sector</AttributeID>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Sub Sector</AttributeID>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Segment</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Employees</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Hierarchylevel2hist</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
              </Dimensions>
            </Aggregation>
            <Aggregation>
              <ID>QueryLogAgg_1</ID>
              <Name>QueryLogAgg_1</Name>
              <Dimensions>
                <Dimension>
                  <CubeDimensionID>Bill Date</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Date Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
              </Dimensions>
            </Aggregation>
            <Aggregation>
              <ID>QueryLogAgg_2</ID>
              <Name>QueryLogAgg_2</Name>
              <Dimensions>
                <Dimension>
                  <CubeDimensionID>Bill Date</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Date Key</AttributeID>
                    </Attribute>
                    <Attribute>
                      <AttributeID>Date Age Group 2</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Bill Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Bill Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Client Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Client Code</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Employees</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Hierarchylevel2hist</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Matter Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Matter Header Curr Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Master Client Details</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Client Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
                <Dimension>
                  <CubeDimensionID>Employees 1</CubeDimensionID>
                  <Attributes>
                    <Attribute>
                      <AttributeID>Dim Fed Hierarchy History Key</AttributeID>
                    </Attribute>
                  </Attributes>
                </Dimension>
              </Dimensions>
            </Aggregation>
          </Aggregations>
        </AggregationDesign>
      </AggregationDesigns>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Budget Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="73bee69f-9fd9-46ef-b4e3-79a34bee96ba">
          <ID>Fact Budget Activity</ID>
          <Name>Fact Budget Current</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="399ccb7a-0fa3-4e2b-ad4d-da29f97cdc66">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_budget_activity.dim_fed_hierarchy_history_key, fact_budget_activity.dim_budget_date_key, fact_budget_activity.budget_date, fact_budget_activity.fed_business_key, 
                         fact_budget_activity.emp_source_system_id, fact_budget_activity.employee_hierarchy_business_key, fact_budget_activity.budget_source_system_id, fact_budget_activity.fed_code, 
                         fact_budget_activity.financial_budget_year, fact_budget_activity.financial_budget_month, 
                         CASE WHEN display_name = 'Budget Balance' THEN team_level_budget_value_balance ELSE fact_budget_activity.fed_level_budget_value END AS budget_value, 
                         CASE WHEN display_name = 'Budget Balance' THEN team_level_budget_value_hours_balance ELSE fact_budget_activity.fed_level_minute_value END AS budget_mins, 
                         fact_budget_activity.fed_level_tb_budget_value, fact_budget_activity.team_level_budget_value, fact_budget_activity.practice_area_level_budget_value, 
                         fact_budget_activity.business_line_level_budget_value, fact_budget_activity.firm_level_budget_value, fact_budget_activity.dss_update_time, fact_budget_activity.dim_gl_date_key, 
                         fact_budget_activity.team_level_budget_value_hours, fact_budget_activity.team_level_budget_value_balance, fact_budget_activity.team_level_budget_value_hours_balance, 
                         fact_budget_activity.team_level_budget_value_hours_billed, 
									 (SELECT min (dim_date_key)	FROM dbo.dim_date WHERE fin_period = (SELECT fin_period FROM dim_date WHERE calendar_date = CAST(GETDATE()-1 AS DATE)) ) Snapshot, dim_days_banding_key
FROM         fact_budget_activity INNER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_budget_activity.dim_fed_hierarchy_history_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE     (fact_budget_activity.dim_gl_date_key &gt;= 20190501)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="8bea51c8-963e-4291-b38b-9758a6fb7e06">
          <ID>Fact Budget Historical</ID>
          <Name>Fact Budget Historical</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="7750e60d-2a05-4e2e-8271-4062cb57711e">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_budget_activity.dim_fed_hierarchy_history_key, fact_budget_activity.dim_budget_date_key, fact_budget_activity.budget_date, fact_budget_activity.fed_business_key, 
                         fact_budget_activity.emp_source_system_id, fact_budget_activity.employee_hierarchy_business_key, fact_budget_activity.budget_source_system_id, fact_budget_activity.fed_code, 
                         fact_budget_activity.financial_budget_year, fact_budget_activity.financial_budget_month, 
                         CASE WHEN display_name = 'Budget Balance' THEN team_level_budget_value_balance ELSE fact_budget_activity.fed_level_budget_value END AS budget_value, 
                         CASE WHEN display_name = 'Budget Balance' THEN team_level_budget_value_hours_balance ELSE fact_budget_activity.fed_level_minute_value END AS budget_mins, 
                         fact_budget_activity.fed_level_tb_budget_value, fact_budget_activity.team_level_budget_value, fact_budget_activity.practice_area_level_budget_value, 
                         fact_budget_activity.business_line_level_budget_value, fact_budget_activity.firm_level_budget_value, fact_budget_activity.dss_update_time, fact_budget_activity.dim_gl_date_key, 
                         fact_budget_activity.team_level_budget_value_hours, fact_budget_activity.team_level_budget_value_balance, fact_budget_activity.team_level_budget_value_hours_balance, 
                         fact_budget_activity.team_level_budget_value_hours_billed, 
									 (SELECT min (dim_date_key)	FROM dbo.dim_date WHERE fin_period = (SELECT fin_period FROM dim_date WHERE calendar_date = CAST(GETDATE()-1 AS DATE)) ) Snapshot, dim_days_banding_key
FROM         fact_budget_activity INNER JOIN
                         dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_budget_activity.dim_fed_hierarchy_history_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE     (fact_budget_activity.dim_gl_date_key &gt;= 20100501)
and    (fact_budget_activity.dim_gl_date_key &lt; 20190501)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Wip</ID>
      <Partitions>
        <Partition dwd:design-time-name="4f6b7f08-e73f-4293-8bdb-37c0dc9ab93d">
          <ID>Fact Wip</ID>
          <Name>Fact Wip 2020</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="31d1dc2a-fa4e-4ff1-918b-38ef4177ea90">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2020)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="76f6456b-c5d5-4e86-a72b-a0809dfd2dba">
          <ID>Fact Wip Historical</ID>
          <Name>Fact Wip 2019</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="e7817864-478a-4013-9a07-7dfd0f15a87b">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2019)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="92e81d9f-165b-46fa-bd68-958b78e7cc43">
          <ID>Fact Wip 2021</ID>
          <Name>Fact Wip 2021</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="3fbd313d-bb3e-4126-9013-ac9dd14df1cd">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2021)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="1c598405-bc64-4155-bc14-23958f0ea1b2">
          <ID>Fact Wip 2022</ID>
          <Name>Fact Wip 2022</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="d7105669-3a25-4aab-93c8-71063611e298">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2022)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="4806c664-10f9-420e-b30c-932996c68d39">
          <ID>Fact Wip 2023</ID>
          <Name>Fact Wip 2023</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="7b421cea-d36c-4e30-96c7-ede065f13f39">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT        fact_wip_monthly.dim_transaction_date_key, fact_wip_monthly.dim_matter_header_history_key, ISNULL(fact_dimension_main.dim_matter_header_curr_key, 0) AS dim_matter_header_current_key, 
                         fact_wip_monthly.dim_fed_hierarchy_history_key, fact_wip_monthly.dim_days_banding_key, fact_wip_monthly.dim_fed_matter_owner_key, fact_wip_monthly.dim_client_key, fact_wip_monthly.source_system_id, 
                         fact_wip_monthly.client, fact_wip_monthly.matter, fact_wip_monthly.matter_owner, fact_wip_monthly.fee_earner_code, fact_wip_monthly.wip_minutes, fact_wip_monthly.wip_value, 
                         fact_wip_monthly.dim_transaction_date_key AS wip_date, 0 AS dim_bill_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code
FROM            fact_wip_monthly LEFT OUTER JOIN
                 fact_dimension_main ON fact_dimension_main.master_fact_key = fact_wip_monthly.master_fact_key
				 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
	
WHERE       fact_wip_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2023)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Bill Billed Time Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="a13914eb-7b61-4fbb-839a-100c488c684b">
          <ID>Fact Bill Billed Time Activity</ID>
          <Name>Fact Bill Billed Time Activity Current</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="91235102-029f-4de5-a91e-0d27c9da6cd0">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE  current_fin_year = 'Current'
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown')</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="815832e7-463f-4e24-b91a-83b145914255">
          <ID>Fact Bill Billed Time Activity 1</ID>
          <Name>Fact Bill Billed Time 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="b2bb73e8-269c-4d6f-a494-95f30e0d43b0">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown')</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="e19ee1e8-642a-4c95-a8ae-6a1308dbcd7f">
          <ID>Fact Bill Billed Time Activity 3 and 4 years old</ID>
          <Name>Fact Bill Billed Time 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="4e6e39c4-65c8-4af9-80c3-d8eafae58bfc">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown')</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="1082a85e-9e3f-4001-a12e-5885bae8f1d4">
          <ID>Fact Bill Billed Time 5 and 6 years old</ID>
          <Name>Fact Bill Billed Time 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="8c12e549-62b2-4723-a9db-1b4db8022d2d">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown')</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="17a4a7f1-e0ec-49ea-a510-f2b7436eb7ca">
          <ID>Fact Bill Billed Time 7 and 8 years old</ID>
          <Name>Fact Bill Billed Time 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="62308fef-da92-46df-85d4-48aa171659d8">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year BETWEEN (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)	
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown')</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="3e739de0-06e0-460e-9a66-574aa441dff1">
          <ID>Fact Bill Billed Time great than 8 years old</ID>
          <Name>Fact Bill Billed Time great than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="8866ec22-d85b-4152-9dd9-f662cecd6a6f">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) matter_owner_hist_key,ISNULL(dim_client.client_code, 'Unknown') master_client_code,
			  SUM(minutes_recorded) minutes_recorded
FROM         fact_bill_billed_time_activity
INNER JOIN dim_date ON dim_date.dim_date_key = fact_bill_billed_time_activity.dim_gl_date_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_gl_date_key, 120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
left outer JOIN dbo.fact_dimension_main ON fact_dimension_main.master_fact_key = fact_bill_billed_time_activity.master_fact_key
LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END	
WHERE fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' ) 
AND  (fact_bill_billed_time_activity.dim_gl_date_key &gt;= 20100501)
GROUP BY  dim_bill_key, fact_bill_billed_time_activity.dim_client_key, dim_transaction_date_key, fact_bill_billed_time_activity.dim_fed_hierarchy_history_key, 
	fact_bill_billed_time_activity.dim_matter_header_curr_key, dim_gl_date_key, 
              dim_days_banding_key, dbo.fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown')</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Billable Time Activity</ID>
      <Partitions>
        <Partition dwd:design-time-name="677d07d6-3092-4ade-a7fa-254b333c9da6">
          <ID>Fact Billable Time Activity</ID>
          <Name>Fact Billable Time Activity Current</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="6d9a961b-5407-41bb-a422-1e0630f6cf27">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
AND current_fin_year = 'Current'

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="7a906111-08d8-4746-89a4-5ba8132eb6fb">
          <ID>Fact Billable Time Activity Historical</ID>
          <Name>Fact Billable Time 1 and 2 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="c5c1c86b-253e-4d95-97b4-8941b6bcee9b">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min
			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 2
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 1
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="419b9c8a-0af0-4b8d-add8-59141c98465b">
          <ID>Fact Billable Time 2 and 3 years old</ID>
          <Name>Fact Billable Time 3 and 4 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="c1da62e7-2298-446b-9a16-311ac6e1e8a1">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min
			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 4
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 3
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="e470c5a0-2322-44f6-a574-48ba2f86d57d">
          <ID>Fact Billable Time 5 and 6 years old</ID>
          <Name>Fact Billable Time 5 and 6 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="eee0d8cb-57e4-4277-a3cd-6766630a619f">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 6
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 5
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="7bb9e41a-0e7d-4b2b-aff0-c40951599884">
          <ID>Fact Billable Time 7 and 8 years old</ID>
          <Name>Fact Billable Time 7 and 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="d3656378-d1b2-4c9f-b68c-fc5006e77f4e">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min
			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year BETWEEN (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND   (SELECT DISTINCT fin_year - 7
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current'		)

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="62ae48c5-af3b-4614-96ab-915f5473ea9b">
          <ID>Fact Billable Time greater than 8 years old</ID>
          <Name>Fact Billable Time greater than 8 years old</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="a7757f94-f235-4b5e-9a6a-39c790c98f16">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0) AS matter_owner_history_key, dim_days_banding_key,
							SUM(minutes_recorded) minutes_recorded, SUM(fact_billable_time_activity.minutes_recorded / 60) AS chargeable_hours
							,  ISNULL(dim_client.client_code, 'Unknown') master_client_code
,staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min
			 ,staff_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_staff_cost_rate
			 ,other_costs_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_other_cost_rate
			 ,total_cost_rate * SUM(fact_billable_time_activity.minutes_recorded / 60) chargeable_hours_total_cost_rate
FROM         fact_billable_time_activity LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_billable_time_activity.master_fact_key
INNER join dim_days_banding on DATEDIFF(d, CAST(CONVERT(CHAR(10), dim_orig_posting_date_key,120) AS DATE), GETDATE()) BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
INNER JOIN dim_date ON dim_date.dim_date_key = fact_billable_time_activity.dim_orig_posting_date_key
 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
			CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END 	LEFT OUTER JOIN dbo.dim_fed_hierarchy_history ON dim_fed_hierarchy_history.dim_fed_hierarchy_history_key = fact_billable_time_activity.dim_fed_hierarchy_history_key	
	LEFT OUTER JOIN dbo.fact_costs_rates ON fact_costs_rates.dim_employee_key = dim_fed_hierarchy_history.dim_employee_key
	AND fact_costs_rates.fin_year = dim_date.fin_year AND fact_costs_rates.fin_month_no = dim_date.fin_month_no
WHERE (fact_billable_time_activity.minutes_recorded &lt;&gt; 0)
and dim_date.fin_year &lt; (SELECT DISTINCT fin_year - 8
					FROM dbo.dim_date
					WHERE current_fin_year = 'Current' )  AND (fact_billable_time_activity.dim_orig_posting_date_key &gt;= 20100501)

GROUP BY  fact_billable_time_activity.dim_bill_key, fact_billable_time_activity.dim_client_key, 
                         fact_billable_time_activity.dim_fed_hierarchy_history_key, fact_billable_time_activity.dim_matter_header_curr_key, fact_billable_time_activity.master_fact_key,                        
                         fact_billable_time_activity.dim_orig_posting_date_key,  ISNULL(fact_dimension_main.dim_fed_hierarchy_history_key, 0), dim_days_banding_key,  ISNULL(dim_client.client_code, 'Unknown'),staff_cost_rate, staff_cost_rate_per_min, other_costs_rate, other_costs_rate_per_min, total_cost_rate, total_cost_rate_per_min</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Debt Monthly</ID>
      <Partitions>
        <Partition dwd:design-time-name="9a1401b2-cc82-437a-b9cd-f835ed1c7871">
          <ID>Fact Debt Monthly</ID>
          <Name>Fact Debt Monthly 2020</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="c13ec928-fbf0-45ce-be67-99a244fb7893">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2020)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="71132de0-8a64-4409-8d0c-daba9fd6e7e4">
          <ID>Fact Debt Monthly 1</ID>
          <Name>Fact Debt Monthly 2019</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="d00ddf73-3b76-4d69-910e-9c6a417ad744">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						 LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2019)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="0151dc09-fab7-45a7-8684-f67fe74ebb93">
          <ID>Fact Debt Monthly 2021</ID>
          <Name>Fact Debt Monthly 2021</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="433e4304-f993-4060-822d-ad047dce8e72">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2021)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="8f7d2251-2ed6-4771-8425-b2f0397e087a">
          <ID>Fact Debt Monthly 2022</ID>
          <Name>Fact Debt Monthly 2022</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="70939497-9b44-458a-b65a-74ac5dd293f3">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
						LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2022)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="1869eac1-13cc-45c0-9968-99c8692d5de7">
          <ID>Fact Debt Monthly 2023</ID>
          <Name>Fact Debt Monthly 2023</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="5e7ab6a9-8e47-41c1-bfe4-e7a6dc16440f">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_debt_monthly.dim_transaction_date_key, fact_debt_monthly.dim_mat_head_history_key, fact_debt_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_dimension_main.dim_fed_hierarchy_history_key, fact_debt_monthly.dim_days_banding_key, fact_debt_monthly.dim_fed_matter_owner_key, fact_debt_monthly.dim_client_key, 
                         fact_debt_monthly.source_system_id, fact_debt_monthly.client_code, fact_debt_monthly.matter_number, fact_debt_monthly.matter_owner, fact_debt_monthly.bill_number, 
                         fact_debt_monthly.bill_date, fact_debt_monthly.outstanding_total_bill, fact_debt_monthly.outstanding_costs, fact_debt_monthly.age_of_debt, fact_debt_monthly.debt_date, 
                         fact_debt_monthly.dim_bill_key, dim_debt_date.dim_date_key AS dim_debt_date_key, ISNULL(dim_client.client_code, 'Unknown') master_client_code, billdate.dim_date_key AS bill_date_key
FROM         fact_debt_monthly LEFT OUTER JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_debt_monthly.master_fact_key
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS dim_debt_date ON dim_debt_date.calendar_date = CAST(fact_debt_monthly.debt_date AS DATE) INNER JOIN
                         dim_date AS billdate ON billdate.calendar_date = CAST(CASE WHEN fact_debt_monthly.bill_date &lt; '20100501' THEN '20100501' ELSE fact_debt_monthly.bill_date END AS DATE)
WHERE          fact_debt_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2023)</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
      <AggregationDesigns>
        <AggregationDesign>
          <ID>AggregationDesign</ID>
          <Name>AggregationDesign</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <EstimatedRows>211640</EstimatedRows>
          <Dimensions>
            <Dimension>
              <CubeDimensionID>Bill Details</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Bill Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Matter Details</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Matter Header Curr Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Client Details</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Client Code</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Bill Date</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Date Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Age Banding</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Age Banding</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Employees 1</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Dim Fed Hierarchy History Key</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
            <Dimension>
              <CubeDimensionID>Dibs WIP and Debt Snapshot</CubeDimensionID>
              <Attributes>
                <Attribute>
                  <AttributeID>Snapshot Date</AttributeID>
                </Attribute>
              </Attributes>
            </Dimension>
          </Dimensions>
        </AggregationDesign>
      </AggregationDesigns>
    </MeasureGroup>
    <MeasureGroup>
      <ID>Fact Disbursements Detail Monthly</ID>
      <Partitions>
        <Partition dwd:design-time-name="de1ddaab-59a2-4dd7-9426-1a39c740d806">
          <ID>Fact Disbursements Detail Monthly</ID>
          <Name>Fact Disbursements Detail Monthly 2019</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="e4343a4e-9815-450c-9c86-10adf4b45497">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2019)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key ,   ISNULL(dim_client.client_code, 'Unknown'), fact_dimension_main.client_code</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="46768fbf-5a0b-462e-92f1-e4ba59521828">
          <ID>Fact Disbursements Detail Monthly Historical</ID>
          <Name>Fact Disbursements Detail Monthly 2020</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="863412da-8081-441f-99cc-508525d63d23">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2020)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key,  ISNULL(dim_client.client_code, 'Unknown'),  fact_dimension_main.client_code</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="9477f791-fdbd-4b81-9776-f72177063757">
          <ID>Fact Disbursements Detail Monthly 2021</ID>
          <Name>Fact Disbursements Detail Monthly 2021</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="3e1ed047-f842-43aa-a762-9c7611848c4a">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2021)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, ISNULL(dim_client.client_code, 'Unknown'), fact_dimension_main.dim_fed_hierarchy_history_key, fact_dimension_main.client_code</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="c2fd3657-65f6-4aef-9021-72b2bc9e1ab8">
          <ID>Fact Disbursements Detail Monthly 2022</ID>
          <Name>Fact Disbursements Detail Monthly 2022</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="265bf09e-56c4-4b20-b17c-7467102c5364">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
		LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2022)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'), fact_dimension_main.client_code</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
        <Partition dwd:design-time-name="bb1c2689-16bb-41d8-800b-8019151f0e7b">
          <ID>Fact Disbursements Detail Monthly 2023</ID>
          <Name>Fact Disbursements Detail Monthly 2023</Name>
          <CreatedTimestamp>0001-01-01T00:00:00Z</CreatedTimestamp>
          <LastSchemaUpdate>0001-01-01T00:00:00Z</LastSchemaUpdate>
          <LastProcessed>0001-01-01T00:00:00Z</LastProcessed>
          <State>Unprocessed</State>
          <Source xsi:type="QueryBinding" dwd:design-time-name="fc22aa08-3ed9-4144-8f5e-89def46404c5">
            <DataSourceID>Red Dw</DataSourceID>
            <QueryDefinition>SELECT   fact_disbursements_detail_monthly.dim_transaction_date_key, fact_disbursements_detail_monthly.dim_matter_header_curr_key AS dim_matter_header_current_key, 
                         fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, fact_disbursements_detail_monthly.dim_client_key, 
                         CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END AS dim_disbursement_date_key, 
                         SUM(fact_disbursements_detail_monthly.total_unbilled_disbursements) AS total_unbilled_disbursements, fact_disbursements_detail_monthly.dim_bill_key, 
                       ISNULL(dim_client.client_code, 'Unknown') master_client_code, isnull(fact_dimension_main.dim_fed_hierarchy_history_key,0) AS matter_owner_hist_key
FROM         fact_disbursements_detail_monthly left outer JOIN
                         fact_dimension_main ON fact_dimension_main.master_fact_key = fact_disbursements_detail_monthly.master_fact_key 
	LEFT outer JOIN dbo.dim_client ON dim_client.client_code = 
						 CASE WHEN ISNUMERIC(master_client_code) = 1 THEN RIGHT('00000000' + CONVERT(VARCHAR, master_client_code), 8) ELSE CAST(RTRIM(master_client_code) AS VARCHAR(8)) END
						  INNER join
                         dim_date AS trandate ON trandate.dim_date_key = fact_disbursements_detail_monthly.dim_transaction_date_key INNER JOIN
                         dim_days_banding ON CASE WHEN dim_transaction_date_key =
                             (SELECT   MAX(dim_transaction_date_key)
                                FROM         fact_disbursements_detail_monthly) THEN DATEDIFF(d, workdate, GETDATE()) ELSE DATEDIFF(d, workdate, trandate.calendar_date) END BETWEEN 
                         dim_days_banding.startdays AND dim_days_banding.enddays AND dim_days_banding.banding_category = 'grouping3'
WHERE   (fact_disbursements_detail_monthly.dim_bill_key = 0) AND (fact_disbursements_detail_monthly.total_unbilled_disbursements &lt;&gt; 0)
and          fact_disbursements_detail_monthly.dim_transaction_date_key IN (SELECT dim_date_key FROM dim_date WHERE fin_year = 2023)

GROUP BY CASE WHEN dim_disbursement_date_key &lt;= '20100501' THEN '20100501' ELSE dim_disbursement_date_key END, fact_disbursements_detail_monthly.dim_transaction_date_key, 
                         fact_disbursements_detail_monthly.dim_matter_header_curr_key, fact_disbursements_detail_monthly.dim_fed_hierarchy_history_key, dim_days_banding.dim_days_banding_key, 
                         fact_disbursements_detail_monthly.dim_client_key, fact_disbursements_detail_monthly.dim_bill_key, fact_dimension_main.master_client_code, fact_dimension_main.dim_fed_hierarchy_history_key, ISNULL(dim_client.client_code, 'Unknown'),   fact_dimension_main.client_code</QueryDefinition>
          </Source>
          <StorageMode>Molap</StorageMode>
          <CurrentStorageMode>Molap</CurrentStorageMode>
          <ProcessingMode>Regular</ProcessingMode>
        </Partition>
      </Partitions>
    </MeasureGroup>
  </MeasureGroups>
</Cube>